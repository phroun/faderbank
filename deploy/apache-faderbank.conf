# Apache config for Faderbank
# Add to your VirtualHost or as a separate conf file

# Required modules (enable if not already):
#   a2enmod proxy proxy_http proxy_wstunnel headers rewrite
# Or on CentOS, they're usually already loaded

# Proxy to Gunicorn
ProxyPreserveHost On

# Tell Flask about the /faderbank prefix
RequestHeader set X-Script-Name /faderbank
RequestHeader set X-Forwarded-Proto https

# WebSocket proxy (must come before regular proxy)
ProxyPass /faderbank/socket.io ws://127.0.0.1:5000/socket.io
ProxyPassReverse /faderbank/socket.io ws://127.0.0.1:5000/socket.io

ProxyPass /faderbank http://127.0.0.1:5000
ProxyPassReverse /faderbank http://127.0.0.1:5000

# Alternative: If faderbank is at root of its own subdomain:
# <VirtualHost *:443>
#     ServerName faderbank.example.com
#
#     ProxyPreserveHost On
#
#     # WebSocket support
#     RewriteEngine On
#     RewriteCond %{HTTP:Upgrade} websocket [NC]
#     RewriteCond %{HTTP:Connection} upgrade [NC]
#     RewriteRule ^/?(.*) ws://127.0.0.1:5000/$1 [P,L]
#
#     ProxyPass / http://127.0.0.1:5000/
#     ProxyPassReverse / http://127.0.0.1:5000/
#
#     # SSL config...
# </VirtualHost>
